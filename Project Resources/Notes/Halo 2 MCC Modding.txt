
////////////////////////
// Halo 2 MCC Modding //
////////////////////////



/*--- Overview ---*/

Mod Tools
  - Assembly: Used before official mod tools were released. Reads map files as tags and lets you
              edit those tag values directly. Can be used to compress/decompress maps.
  - Guerilla: An official, comprehensive tag editor.
  - Tool: A terribly named command line utility that does all kinds of stuff. Most important for
          us, it allows you to compile a bunch of tags into a .map file that can be played in MCC. 



/*--- Rebuilding Map from Tags in Guerilla ---*/

NOTE: Doesn't support compile flags, which is a problem for remastered campaign levels. In general
      probably just safest to do this via command line (see below).

0. Navigate to H2EK Folder via command line.

1. Open Guerrila

	guerilla.exe -tags_dir "D:\Games\Installed - Steam\steamapps\common\H2EK\tags"

2. In Guerrila -> File -> Run Tool -> Select "build cache file" & browse to scenario file.

3. Click "Ok". Map file will be saved to h2_maps_win64_dx11 directory.



/*--- Rebuilding Map from Tags via Command Line ---*/

NOTE: Supports compile flags! :)

1. Navigate to H2EK Folder via command line.

2. Run the Following

	tool build-cache-file scenarios\solo\01b_spacestation\01b_spacestation dx11_64 remastered_support



/*--- More Reference ---*/

Tool Documentation: https://c20.reclaimers.net/h2/tools/h2-ek/h2-tool/

guerilla -tags_dir "D:\Games\Installed - Steam\steamapps\common\H2EK\tags"

Map Name            | Other Internal Names     | Level Name
--------------------|--------------------------|-------------------
00a_introduction    |                          | The Heretic
01a_tutorial        |                          | The Armory
01b_spacestation    | ss                       | Cairo Station
03a_oldmombasa      |                          | Outskirts
03b_newmombasa      | earthcity                | Metropolis
04a_gasgiant        | alphagasgiant            | The Arbiter
04b_floodlab        |
05a_deltaapproach
05b_deltatowers
06a_sentinelwalls   | shq
06b_floodzone
07a_highcharity
07b_forerunnership
08a_deltacliffs
08b_deltacontrol



///////////////////////////
// H2A Audio Restoration //
///////////////////////////

1. Start by replacing the all tags in the "sound_remaster" folder with their corresponding tags in
   the "sound" folder. This works for ~80% of in-game audio. The many exceptions are chronicled below.

2. Special Cases (Scripted)

    All Tags
     ".sound_looping" Files - These need to be preserved as-is.
     "*_lod.sound" Files - These are remaster additions that don't exist in the classic game.
                           They're distant, more echoed versions of game sounds to be
                           generated by NPC fire. Can be deleted. In some cases, the min/max distance
                           of the object's base sound tag must be updated via Guerilla. Otherwise,
                           sound can't be heard at a distance. (Automate?)
     "*_swtnr.sound" Files - These are remaster additions that don't exist in the classic game.
                             They're followup sounds to be played after the classic sound. Safe
                             to delete; they just won't play.
     "*_lfe.sound" Files - Also remaster additions that don't exist in the classic game. These sounds
                           seem to be an additional bass layer that plays alongside standard sounds
                           to give them more punch. Can be safely deleted.

    Weapons
      Plasma Rifle - deleted "plas_rifle_fire_bottom.sound", seems to be new sound specifically
                     emitted from bottom of gun when firing.
      Energy Sword - sword_ready.sound (classic) --> energy_sword_ready.sound (remaster)
      Sniper Rifle - Zoom in/out wrong?
      Beam Rifle - beam_rifle_zoom_in[/out].sound (classic) -> beamrifle_zoom/in[/out].sound (remaster)
      Rocket - rocket_expl.sound (classic) -> projectile_exp/close.sound (remaster)
               Zoom in/out wrong (same as sniper?)
      Chain Gun - Remastered warthog turret has annoying whirring noise. Can remove by deleting
                  "weapons/chain_gun/chaingun_spin.sound" in "sound_remaster".
      Fuel Rod Gun - Explosion sounds too punchy? Tag files look good. Blegh, gonna just leave it.
      Sentinel Beam - Weapon audio stored in character folder. Needs to be updated there.
                      "sent_gun\" (classic) -> "sent_gun\" (remaster), "sent_gun_lod" (remaster)
      Brute Shot - preserved new tag for mechanical click when firing
      Hunter Cannon - renamed fire and loop tags for prophet variant to match remaster

    Vehicles
      Warthog
        renamed tag for crash sfx
      Scorpion
        deleted new tags for turret spin
        deleted new tag for reload
        preserved new tag for Delta Halo dropoff
      Pelican
        preserved new tag for landing gear retraction
        preserved new tag for jet thruster popping (???)
      Ghost
        renamed tag for main fire
        deleted tag for extra boost
      Wraith
        renamed tag for main fire
        renamed tag for mortar explosion
      Spectre
        deleted tag for extra boost
      Banshee
        renamed tag for main fire
      Gravity Throne (Regret Chair - NEEDS TESTING)
        deleted tag for teleport reflection
        replaced tags for extra fire in/out sounds
      Phantom
        deleted tags for turret animation sounds
        copied and renamed fire tag to replace secondary fire tag
      Damage Effects
        preserved new tag for hitting bipeds

    Characters
      Sentinel Enforcer
        needler_fire_sentinel_enforcer.sound (classic) -> sentinel_enforcer_laser.sound (remaster)
        Note: The remastered primary fire actually sounds pretty good as a Enforcer rocket fire
              and helps broadcast the incoming salvo... Might make it optional later.

    Levels
      Regret
        Gondala launch sound is very wrong
        Water hall ambient noise is annoying bell toll

    Visual Effects
      preserved new tag for InAmberClad flyby, faithful & sick as hell
      renamed tag for InAmberClad slipspace rupture, less faithful & less cool


3. Manual Fixes (Manual)

    Note: Min and max distance for Halo sounds correspond to the distance at which
          their volume begins and completes fading out. Therefore, a larger min
          distance actually leads to a louder sound at greater distances.

    Weapons
      Sentinel Beam
        sound_remastered\characters\sentinel\sentinel_gun\sent_gun\* - min dist 5, max dist 100
      Plasma Pistol
        sound_remastered\weapons\plasma_pistol\fire.sound - min dist 3, max dist 75
        sound_remastered\weapons\plasma_pistol\chargefire.sound - min dist 3, max dist 75
        sound_remastered\weapons\plasma_pistol\startcharge.sound - min dist 3, max dist 75
      Plasma Rifle
        sound_remastered\weapons\plasma_rifle\plasma_rifle_fire.sound - min dist 3, max dist 75
      Needler
        sound_remastered\weapons\needler\fire.sound - min dist 3, max dist 75
      Covenant Carbine
        sound_remastered\weapons\covenant_carbine\fire.sound - min dist 4, max dist 100
      Beam Rifle
        sound_remastered\weapons\beam_rifle\fire_burst.sound - min dist 2, max dist 75
      Magnum
        sound_remastered\weapons\battle_rifle\magnum_fire.sound - min dist 2, max dist 75
      Magnum
        sound_remastered\weapons\magnum\magnum_fire.sound - min dist 2, max dist 75
      Plasma Turret
        sound_remastered\weapons\plasma_turret\fire.sound - base gain -16

    Vehicles

    Characters
      Sentinel Enforcer
        characters\sentinel\sentinel_enforcer_laser.sound - min dist = 25, max dist = 75, "play only in legacy mode" = unticked



/*--- Changing Tags in Assembly ---*/

1. Open Assembly (Halo mod tool, not machine language)

2. Tools > Map Compressor > Set "Input Map" to selected MCC map > Click "De/Compress Map"

3. Open Map in New Tab > Tags tab

4. Find & Edit the appropriate tag. Then compress map again and play the game.



/*--- Recursive Walk Refactor Stats ---*/

Before

    Classic Audio Restored
    ----------------------
    Updated            640
    Replaced           571
    Deleted            69
    Preserved          84
    ----------------------

After (Discretionary Preservation on)

    Classic Audio Restored
    ----------------------
    Updated            640
    Replaced           571
    Deleted            69
    Preserved          183
    ----------------------

After (Discretionary Preservation off)

    Classic Audio Restored
    ----------------------
    Updated            734
    Replaced           578
    Deleted            156
    Preserved          73
    ----------------------





    [01b_spacestation_mission line 649] this is not a reference to a sound tag.: sound_remastered\ambience\spacestation\docking_clangs\dockingcov_incoming none 1)