
////////////////////////
// Halo 2 MCC Modding //
////////////////////////


/*--- Overview ---*/

    Mod Tools
      - Assembly: Used before official mod tools were released. Reads map files as tags and lets you
                  edit those tag values directly. Can be used to compress/decompress maps.
      - Guerilla: An official, comprehensive tag editor.
      - Tool: A terribly named command line utility that does all kinds of stuff. Most important for
              us, it allows you to compile a bunch of tags into a .map file that can be played in MCC.


/*--- Rebuilding Map from Tags in Guerilla ---*/

    NOTE: Doesn't support compile flags, which is a problem for remastered campaign levels. In general
          probably just safest to do this via command line (see below).

    0. Navigate to H2EK Folder via command line.

    1. Open Guerrila

        guerilla.exe -tags_dir "D:\Games\Installed - Steam\steamapps\common\H2EK\tags"

    2. In Guerrila -> File -> Run Tool -> Select "build cache file" & browse to scenario file.

    3. Click "Ok". Map file will be saved to h2_maps_win64_dx11 directory.


/*--- Rebuilding Map from Tags via Command Line ---*/

    NOTE: Supports compile flags! :)

    1. Navigate to H2EK Folder via command line.

    2. Run the Following

        tool build-cache-file scenarios\solo\01b_spacestation\01b_spacestation dx11_64 remastered_support


/*--- Changing Tags in Assembly ---*/

    1. Open Assembly (Halo mod tool, not machine language)

    2. Tools > Map Compressor > Set "Input Map" to selected MCC map > Click "De/Compress Map"

    3. Open Map in New Tab > Tags tab

    4. Find & Edit the appropriate tag. Then compress map again and play the game.



///////////////////////////
// H2A Audio Restoration //
///////////////////////////


/*--- The Process ---*/

    1. Start by replacing the all tags in the "sound_remaster" folder with their corresponding tags in
       the "sound" folder. This works for ~80% of in game audio. The many exceptions are chronicled below.

    2. Special Cases (Scripted)

        All Tags
         ".sound_looping" Files - These need to be preserved as-is.
         "*_lod.sound" Files - These are remaster additions that don't exist in the classic game.
                               They're distant, more echoed versions of game sounds to be
                               generated by NPC fire. Can be deleted. In some cases, the min/max distance
                               of the object's base sound tag must be updated via Guerilla. Otherwise,
                               sound can't be heard at a distance. (Automate?)
         "*_swtnr.sound" Files - These are remaster additions that don't exist in the classic game.
                                 They're followup sounds to be played after the classic sound. Safe
                                 to delete; they just won't play.
         "*_lfe.sound" Files - Also remaster additions that don't exist in the classic game. These sounds
                               seem to be an additional bass layer that plays alongside standard sounds
                               to give them more punch. Can be safely deleted.

        Weapons
          Plasma Rifle - deleted "plas_rifle_fire_bottom.sound", seems to be new sound specifically
                         emitted from bottom of gun when firing.
          Energy Sword - sword_ready.sound (classic) --> energy_sword_ready.sound (remaster)
          Sniper Rifle - Zoom in/out wrong?
          Beam Rifle - beam_rifle_zoom_in[/out].sound (classic) -> beamrifle_zoom/in[/out].sound (remaster)
          Rocket - rocket_expl.sound (classic) -> projectile_exp/close.sound (remaster)
                   Zoom in/out wrong (same as sniper?)
          Chain Gun - Remastered warthog turret has annoying whirring noise. Can remove by deleting
                      "weapons/chain_gun/chaingun_spin.sound" in "sound_remaster".
          Fuel Rod Gun - Explosion sounds too punchy? Tag files look good. Blegh, gonna just leave it.
          Sentinel Beam - Weapon audio stored in character folder. Needs to be updated there.
                          "sent_gun\" (classic) -> "sent_gun\" (remaster), "sent_gun_lod" (remaster)
          Brute Shot - preserved new tag for mechanical click when firing
          Hunter Cannon - renamed fire and loop tags for prophet variant to match remaster

        Vehicles
          Warthog
            renamed tag for crash sfx
          Scorpion
            deleted new tags for turret spin
            deleted new tag for reload
            preserved new tag for Delta Halo dropoff
          Pelican
            preserved new tag for landing gear retraction
            preserved new tag for jet thruster popping (???)
          Ghost
            renamed tag for main fire
            deleted tag for extra boost
          Wraith
            renamed tag for main fire
            renamed tag for mortar explosion
          Spectre
            deleted tag for extra boost
          Banshee
            renamed tag for main fire
          Gravity Throne (Regret Chair - NEEDS TESTING)
            deleted tag for teleport reflection
            replaced tags for extra fire in/out sounds
          Phantom
            deleted tags for turret animation sounds
            copied and renamed fire tag to replace secondary fire tag
          Damage Effects
            preserved new tag for hitting bipeds

        Characters
          Sentinel Enforcer
            needler_fire_sentinel_enforcer.sound (classic) -> sentinel_enforcer_laser.sound (remaster)
            Note: The remastered primary fire actually sounds pretty good as a Enforcer rocket fire
                  and helps broadcast the incoming salvo... Might make it optional later.

        Levels (preserved all new ambient except following)
          Regret
            restored gondola sounds
            restored water hall music
          The Armory
            restored shield charging station track 2 (mechanical layer)
            restored computer sounds
          Cairo Station
            restored muffled fighting beyond bulkhead
            deleted boarding craft approach sound
            restored docking sounds
            restored distant explosion & docking sounds
            restored mac cannon fire & reload sounds
            // restored warning alarm
          Metropolis
            restored scarab tags except new walk and piston stop tags
          Delta Halo
            preserved new tags for bridge extension

        Visual Effects
          preserved new tag for InAmberClad flyby, faithful & sick as hell
          renamed tag for InAmberClad slipspace rupture, less faithful & less cool

    3. Manual Fixes (Manual)

        Follow the directions in 'Manual Fixes.txt'.

    4. Use 'tool' to build a map file from the new tags.

        tool build-cache-file scenarios\solo\01b_spacestation\01b_spacestation dx11_64 remastered_support

    5. Move the generated map file to the appropriate MCC installation folder.

        H2EK Generated Maps: '<H2EK installation>\h2_maps_win64_dx11'
        MCC Folder: '<MCC installation>\halo2\h2_maps_win64_dx11'



/*--- Hard Earned Knowledge ---*/

    'Tool' Documentation:

        https://c20.reclaimers.net/h2/tools/h2-ek/h2-tool/

    Launching Guerilla w/ Specific Tag Directory:

        guerilla -tags_dir "D:\Games\Installed - Steam\steamapps\common\H2EK\tags"

    Internal Level Identifiers

        .---------------------------------------------------------------------------------.
        | Map Name            | Other Internal Names     | Level Name        | State      |
        |---------------------|--------------------------|-------------------|------------|
        | 00a_introduction    |                          | The Heretic       | Done       |
        | 01a_tutorial        |                          | The Armory        | Done       |
        | 01b_spacestation    | ss                       | Cairo Station     | Done       |
        | 03a_oldmombasa      |                          | Outskirts         | Done       |
        | 03b_newmombasa      | earthcity, nm            | Metropolis        | Done       |
        | 04a_gasgiant        | alphagasgiant            | The Arbiter       | Done       |
        | 04b_floodlab        |                          | The Oracle        | Done       |
        | 05a_deltaapproach   | delta                    | Delta Halo        | Done       |
        | 05b_deltatowers     |                          | Regret            | Done       |
        | 06a_sentinelwalls   | shq, SentHeadQuar        | Sacred Icon       | Done       |
        | 06b_floodzone       |                          | Quarantine Zone   | Done       |
        | 07a_highcharity     | high                     | Gravemind         | Done       |
        | 08a_deltacliffs     |                          | Uprising          | Done       |
        | 07b_forerunnership  |                          | High Charity      | Restored   |
        | 08b_deltacontrol    |                          | The Great Journey | Restored   |
        '---------------------------------------------------------------------------------'
        Progress: Restored -> Rebalanced -> Done

    Tag Editing Notes

        Min and max distance for Halo sounds correspond to the distance at which
        their volume begins and completes fading out. Therefore, a larger min
        distance actually leads to a louder sound at greater distances.

    Noteworthy 'Tool' Errors

        // Removing this tag broke the map build. A tag with this name *must* exist.
        [<map>_mission line ###] this is not a reference to a sound tag.: <path to tag> none 1)
        // Example of above
        [01b_spacestation_mission line 649] this is not a reference to a sound tag.: sound_remastered\ambience\spacestation\docking_clangs\dockingcov_incoming none 1)

    Campaign Sound File Locations

        To find a campaign sound file, check the following directories in order of likelihood:
            tags/sound_remastered/visual_effects
            tags/sound_remastered/ambience/<map name>
            tags/sound_remastered/ambience/device_machines
            tags/sound_remastered/sound_scenery

        Other Noteworthy
            tags/sound/ambience/device_machines/insertion_pods/resupply_pod_impact.sound

    Tag Binary File Format

        Numeric tag file values are stored as 4-byte floats in Big Endian (most significant
        bytes first). This means most conversion tools spit out hex representations in inverted
        byte order, which caused some headache while investigating the format.

        Boolean tag values are stored in a single byte with the following equivalent hex
        values: true = '0c', false = '08'



/*--- Final Report ---*/

  .------------------------.
  | Updated            808 |
  | Replaced           734 |
  | Deleted             74 |
  | Preserved         1401 |
  |------------------------|
  | Problems             0 |
  '------------------------'


/*--- 06.16.2023 Report ---*/

  .---------------------------.
  | Total Tags Changed   1511 |
  | > Replaced            750 |
  | > Modified            890 |
  | > Deleted              74 |
  | > Preserved          9421 |
  |---------------------------|
  | Problems                0 |
  '---------------------------'



